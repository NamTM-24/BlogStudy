<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Chat System Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="/css/chat-widget.css" />
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold text-center mb-8">
        Test Chat System Complete
      </h1>

      <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Hướng dẫn test đầy đủ:</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Test cho User -->
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-bold text-blue-800 mb-2">
              Test Chat Widget (User)
            </h3>
            <ol class="list-decimal list-inside space-y-2 text-blue-700">
              <li>Đăng nhập với tài khoản user thường</li>
              <li>Chat widget sẽ xuất hiện ở góc phải dưới</li>
              <li>Click vào nút chat để mở widget</li>
              <li>Gửi tin nhắn và kiểm tra</li>
              <li>Admin sẽ nhận được thông báo</li>
            </ol>
          </div>

          <!-- Test cho Admin -->
          <div class="bg-green-50 p-4 rounded-lg">
            <h3 class="font-bold text-green-800 mb-2">Test Admin Chat</h3>
            <ol class="list-decimal list-inside space-y-2 text-green-700">
              <li>Đăng nhập với tài khoản admin</li>
              <li>Chat widget sẽ xuất hiện ở góc phải, cao hơn user</li>
              <li>
                Truy cập
                <a href="/admin/chat-fixed" class="underline"
                  >/admin/chat-fixed</a
                >
              </li>
              <li>Chọn user từ danh sách online</li>
              <li>Gửi tin nhắn và kiểm tra user nhận được</li>
            </ol>
          </div>
        </div>

        <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
          <h3 class="font-semibold text-yellow-800 mb-2">
            Kiểm tra tính năng:
          </h3>
          <ul class="space-y-2 text-yellow-700">
            <li>✅ Chat widget có vị trí khác nhau cho admin và user</li>
            <li>✅ Admin và user có thể gửi tin nhắn cho nhau</li>
            <li>✅ Thông báo real-time khi có tin nhắn mới</li>
            <li>✅ Lịch sử chat được lưu trữ</li>
            <li>✅ Anti-duplicate message logic</li>
          </ul>
        </div>

        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
          <h3 class="font-semibold text-gray-800 mb-2">Debug Console:</h3>
          <div
            id="debug-console"
            class="bg-black text-green-400 p-3 rounded font-mono text-sm h-40 overflow-y-auto"
          >
            <div>Chat System Debug Console...</div>
          </div>
        </div>

        <div class="mt-6 flex space-x-4">
          <a
            href="/admin/chat-fixed"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors"
          >
            Admin Chat Interface
          </a>
          <a
            href="/test-chat"
            class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors"
          >
            Simple Chat Test
          </a>
          <button
            id="clear-debug"
            class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors"
          >
            Clear Debug
          </button>
        </div>
      </div>
    </div>

    <script src="/js/chat-widget.js"></script>
    <script>
      // Enhanced debug console
      const debugConsole = document.getElementById("debug-console");
      const originalLog = console.log;
      const originalError = console.error;

      function addToDebugConsole(message, type = "log") {
        const div = document.createElement("div");
        div.className = type === "error" ? "text-red-400" : "text-green-400";
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        debugConsole.appendChild(div);
        debugConsole.scrollTop = debugConsole.scrollHeight;
      }

      console.log = function (...args) {
        originalLog.apply(console, args);
        addToDebugConsole(args.join(" "), "log");
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        addToDebugConsole(args.join(" "), "error");
      };

      document.getElementById("clear-debug").addEventListener("click", () => {
        debugConsole.innerHTML = "<div>Debug console cleared...</div>";
      });

      // Test script để kiểm tra chat widget
      document.addEventListener("DOMContentLoaded", () => {
        console.log("Test page loaded");

        // Kiểm tra xem chat widget có được load không
        setTimeout(() => {
          const chatWidget = document.getElementById("chat-widget");
          if (chatWidget) {
            console.log("✅ Chat widget found");
            console.log("Widget classes:", chatWidget.className);

            // Kiểm tra vị trí
            const computedStyle = window.getComputedStyle(chatWidget);
            console.log("Widget position:", {
              position: computedStyle.position,
              bottom: computedStyle.bottom,
              right: computedStyle.right,
              transform: computedStyle.transform,
            });
          } else {
            console.log("❌ Chat widget not found");
          }
        }, 1000);

        // Test user role detection
        setTimeout(() => {
          if (window.ChatWidget) {
            console.log("ChatWidget instance available");
          }
        }, 2000);
      });
    </script>
  </body>
</html>
